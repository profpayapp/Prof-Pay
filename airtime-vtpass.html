<script>
  const form = document.getElementById('airtimeForm');
  const msg = document.getElementById('responseMsg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = 'Processing...';

    const phone = document.getElementById('phone').value;
    const network = document.getElementById('network').value;
    const amount = document.getElementById('amount').value;

    // VTpass requires serviceID like: "mtn", "glo", "airtel", "etisalat"
    const serviceID = network;

    // Generate a valid Request ID in correct format
    const date = new Date();
    const request_id =
      date.getFullYear().toString() +
      String(date.getMonth() + 1).padStart(2, '0') +
      String(date.getDate()).padStart(2, '0') +
      String(date.getHours()).padStart(2, '0') +
      String(date.getMinutes()).padStart(2, '0') +
      String(Math.floor(Math.random() * 100000)); // Add randomness

    const payload = {
      request_id,
      serviceID,
      billersCode: phone,
      amount,
      phone
    };

    try {
      const response = await fetch('https://sandbox.vtpass.com/api/pay', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'api-key': '6e42765736a76d61f25b1073866f2947',
          'Authorization': 'Basic ' + btoa('PK_6674c3f579be5f6fc7055c53cf949ebaf51c6ab714d:SK_399627c47bc2053d6ec3b36be66e1311277d3643d05')
        },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.code === '000') {
        msg.textContent = `✅ Airtime sent successfully to ${phone} on ${network.toUpperCase()} - ₦${amount}`;
      } else {
        msg.textContent = `❌ Error: ${result.response_description || result.message || 'Check Request ID or ServiceID'}`;
      }

    } catch (error) {
      msg.textContent = '❌ Network error, please try again.';
      console.error(error);
    }
  });
</script>
